import{l as P,r as o,y as tt,m as y,I as g,n as D,O as x,j as i,C as O,T as nt,o as k,S as et,t as ot,p as lt,q as S,B as it,L as dt,s as ut,N as Ct}from"./index-TwdfaXd4.js";const ct=({searchParams:t,onChange:I})=>{const b=P(),[_,F]=o.useState([]),[M,G]=o.useState([]),[A,T]=o.useState(!1),[U,$]=o.useState(!1),[B,H]=o.useState(!1),[z,h]=o.useState(""),[V,Y]=o.useState(""),C=o.useCallback((n,l)=>{if(t[n]!==l){const c={...t,[n]:l};I(c)}},[t,I]),d=o.useCallback(n=>{tt.error(n)},[]),f=t.adultCount+t.childCount+t.infantCount,q=(n,l)=>{f<y?C(n,l+1):d(D)},N=(n,l)=>{C(n,l>0?l-1:0)},J=o.useCallback(()=>{if(f<y){const n=t.adultCount+1;n<t.infantCount?d(g):C("adultCount",n)}else d(D)},[f,t.adultCount,t.infantCount,d]),K=o.useCallback(()=>{if(t.adultCount>0){const n=t.adultCount-1;n<t.infantCount&&(d(g),C("infantCount",n)),C("adultCount",n)}},[t.adultCount,t.infantCount,d]),X=o.useCallback(()=>q("childCount",t.childCount),[f,t.childCount,d]),Q=o.useCallback(()=>N("childCount",t.childCount),[t.childCount]),W=o.useCallback(()=>{t.adultCount===0||t.infantCount>=t.adultCount?d(g):f<y?C("infantCount",t.infantCount+1):d(D)},[t.adultCount,t.infantCount,f,d]),Z=o.useCallback(()=>N("infantCount",t.infantCount),[t.infantCount]),v=(n,l)=>{const[c,p]=o.useState(n);return o.useEffect(()=>{const a=setTimeout(()=>{p(n)},l);return()=>{clearTimeout(a)}},[n,l]),c},s=v(z,300),r=v(V,300),E=async(n,l,c)=>{var p;if(!(n.length<2)){c(!0);try{const u=(p=(await ut.get(`flight/search/city?subType=AIRPORT&keyword=${n}`)).data)==null?void 0:p.map(e=>{var j,L,R;return{value:e==null?void 0:e.iata,label:`${e==null?void 0:e.name}`,city:{address:{cityCode:(j=e==null?void 0:e.address)==null?void 0:j.cityCode,cityName:(L=e==null?void 0:e.address)==null?void 0:L.cityName,countryName:(R=e==null?void 0:e.address)==null?void 0:R.countryName},name:e==null?void 0:e.name,iata:e==null?void 0:e.iata,city:e==null?void 0:e.city,country:e==null?void 0:e.country}}});u&&u.length>0?l(u):d(Ct)}finally{c(!1)}}};o.useEffect(()=>{s&&E(s,F,$)},[s]),o.useEffect(()=>{r&&E(r,G,H)},[r]);const m=o.useCallback(async()=>{T(!0);const n="https://test.ffsdtravels.com/api/flight/search/offer",l=x(new Date(t.departureDate),"yyyy-MM-dd"),c=x(new Date(t.returnDate),"yyyy-MM-dd"),p={currencyCode:"NGN",originDestinations:[{id:"1",originLocationCode:t.departureCity,destinationLocationCode:t.arrivalCity,departureDateTimeRange:{date:l,time:"10:00:00"}},{id:"2",originLocationCode:t.arrivalCity,destinationLocationCode:t.departureCity,departureDateTimeRange:{date:c,time:"10:00:00"}}],travelers:[...Array.from({length:t.adultCount},(a,u)=>({id:`${u+1}`,travelerType:"ADULT",fareOptions:["STANDARD"]})),...Array.from({length:t.childCount},(a,u)=>({id:`${t.adultCount+u+1}`,travelerType:"CHILD",fareOptions:["STANDARD"]})),...Array.from({length:t.infantCount},(a,u)=>({id:`${t.adultCount+t.childCount+u+1}`,travelerType:"HELD_INFANT",associatedAdultId:`${u+1}`,fareOptions:["STANDARD"]}))],sources:["GDS"],searchCriteria:{maxFlightOffers:50,pricingOptions:{fareType:["PUBLISHED"]},flightFilters:{cabinRestrictions:[{cabin:t.selectedClass.toUpperCase(),coverage:"MOST_SEGMENTS",originDestinationIds:["1"]}]}},additionalInformation:{brandedFares:!0}};try{const a=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer YOUR_API_TOKEN"},body:JSON.stringify(p)});if(!a.ok)throw new Error("Network response was not ok");const u=await a.json();b("/roundtripsearch",{state:{searchResults:u.data,searchParams:t}})}catch(a){console.error("Error fetching flight data:",a),d("Failed to fetch flight data.")}finally{T(!1)}},[t,b]),w=o.useCallback((n,l)=>{l&&C(n,x(l,"yyyy-MM-dd"))},[C]);return i.jsx("div",{className:"flex flex-col gap-5 w-full items-center px-4",children:i.jsxs("div",{className:"flex lg:flex-row flex-col lg:gap-12 md:gap-9 sm:gap-6 gap-4 w-full lg:items-center justify-between",children:[i.jsxs("div",{className:"flex lg:flex-row flex-col items-center lg:gap-6 gap-3",children:[i.jsx(O,{data:_,placeholder:"City",onSearch:h,loading:U,value:t==null?void 0:t.departureCity,onChange:n=>C("departureCity",n)}),i.jsx("div",{className:"lg:w-[50px] lg:h-[50px] lg:p-3 w-[45px] h-[45px] p-2 rounded-full bg-primaryRed bg-opacity-[8%]",children:i.jsx(nt,{size:"10",stroke:"#E5302f"})}),i.jsx(O,{data:M,placeholder:"City",onSearch:Y,loading:B,value:t==null?void 0:t.arrivalCity,onChange:n=>C("arrivalCity",n)})]}),i.jsx(k,{onChange:n=>w("departureDate",n),value:new Date(t==null?void 0:t.departureDate)}),(t==null?void 0:t.returnDate)&&i.jsx(k,{onChange:n=>w("returnDate",n),value:new Date(t.returnDate)}),i.jsx(et,{data:ot,placeholder:"Class",value:t.selectedClass,onChange:n=>C("selectedClass",n)}),i.jsx(lt,{btnText:"Add Passenger",children:i.jsxs("div",{className:"flex flex-col gap-3 py-2",children:[i.jsx(S,{label:"Adults ( â‰¥ 12 years)",count:t==null?void 0:t.adultCount,increment:J,decrement:K}),i.jsx(S,{label:"Children ( 2 - 12 years)",count:t==null?void 0:t.childCount,increment:X,decrement:Q}),i.jsx(S,{label:"Infants ( < 2 years)",count:t==null?void 0:t.infantCount,increment:W,decrement:Z})]})}),i.jsx(it,{onClick:m,className:"bg-primaryRed duration-300 lg:w-[120px] w-[100px] h-12",disabled:A,children:A?i.jsx(dt,{color:"#FFFFFF",size:"20"}):"Search"})]})})};export{ct as R};
