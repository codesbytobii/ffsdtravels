import{l as Q,r as s,y as ce,m as F,I as E,n as R,O as K,j as e,C as V,T as de,o as X,S as xe,t as ue,p as ge,q as O,B as _,L as $,s as pe,N as fe,Q as W,z as Z,w as he,E as me,R as P,G as ee,U as je,V as ye,W as Ce,X as be,H as Ne}from"./index-TwdfaXd4.js";import{P as ve,a as we,b as L,c as De,d as Se,e as ke,L as Ie}from"./pagination-BFiW4Ks1.js";import"./chevron-left-BAFd-DeY.js";const Ae=({searchParams:t,onChange:d})=>{const n=Q(),[o,x]=s.useState([]),[g,C]=s.useState([]),[r,b]=s.useState(!1),[h,y]=s.useState(!1),[i,u]=s.useState(!1),[v,D]=s.useState(""),[S,k]=s.useState(""),m=s.useCallback((a,c)=>{if(t[a]!==c){const N={...t,[a]:c};d(N)}},[t,d]),p=s.useCallback(a=>{ce.error(a)},[]),w=t.adultCount+t.childCount+t.infantCount,te=(a,c)=>{w<F?m(a,c+1):p(R)},M=(a,c)=>{m(a,c>0?c-1:0)},ae=s.useCallback(()=>{if(w<F){const a=t.adultCount+1;a<t.infantCount?p(E):m("adultCount",a)}else p(R)},[w,t.adultCount,t.infantCount,p]),se=s.useCallback(()=>{if(t.adultCount>0){const a=t.adultCount-1;a<t.infantCount&&(p(E),m("infantCount",a)),m("adultCount",a)}},[t.adultCount,t.infantCount,p]),le=s.useCallback(()=>te("childCount",t.childCount),[w,t.childCount,p]),ne=s.useCallback(()=>M("childCount",t.childCount),[t.childCount]),ie=s.useCallback(()=>{t.adultCount===0||t.infantCount>=t.adultCount?p(E):w<F?m("infantCount",t.infantCount+1):p(R)},[t.adultCount,t.infantCount,w,p]),oe=s.useCallback(()=>M("infantCount",t.infantCount),[t.infantCount]),B=(a,c)=>{const[N,f]=s.useState(a);return s.useEffect(()=>{const j=setTimeout(()=>{f(a)},c);return()=>{clearTimeout(j)}},[a,c]),N},I=B(v,300),A=B(S,300),G=async(a,c,N)=>{var f;if(!(a.length<2)){N(!0);try{const T=(f=(await pe.get(`flight/search/city?subType=AIRPORT&keyword=${a}`)).data)==null?void 0:f.map(l=>{var U,H,J;return{value:l==null?void 0:l.iata,label:`${l==null?void 0:l.name}`,city:{address:{cityCode:(U=l==null?void 0:l.address)==null?void 0:U.cityCode,cityName:(H=l==null?void 0:l.address)==null?void 0:H.cityName,countryName:(J=l==null?void 0:l.address)==null?void 0:J.countryName},name:l==null?void 0:l.name,iata:l==null?void 0:l.iata,city:l==null?void 0:l.city,country:l==null?void 0:l.country}}});T&&T.length>0?c(T):p(fe)}finally{N(!1)}}};s.useEffect(()=>{I&&G(I,x,y)},[I]),s.useEffect(()=>{A&&G(A,C,u)},[A]);const re=s.useCallback(async()=>{b(!0);const a="https://test.ffsdtravels.com/api/flight/search/offer",c=K(new Date(t.departureDate),"yyyy-MM-dd"),N={currencyCode:"NGN",originDestinations:[{id:"1",originLocationCode:t.departureCity,destinationLocationCode:t.arrivalCity,departureDateTimeRange:{date:c,time:"10:00:00"}}],travelers:[...Array.from({length:t.adultCount},(f,j)=>({id:`${j+1}`,travelerType:"ADULT",fareOptions:["STANDARD"]})),...Array.from({length:t.childCount},(f,j)=>({id:`${t.adultCount+j+1}`,travelerType:"CHILD",fareOptions:["STANDARD"]})),...Array.from({length:t.infantCount},(f,j)=>({id:`${t.adultCount+t.childCount+j+1}`,travelerType:"HELD_INFANT",associatedAdultId:`${j+1}`,fareOptions:["STANDARD"]}))],sources:["GDS"],searchCriteria:{maxFlightOffers:50,pricingOptions:{fareType:["PUBLISHED"]},flightFilters:{cabinRestrictions:[{cabin:t.selectedClass.toUpperCase(),coverage:"MOST_SEGMENTS",originDestinationIds:["1"]}]}},additionalInformation:{brandedFares:!0}};try{const f=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer YOUR_API_TOKEN"},body:JSON.stringify(N)});if(!f.ok)throw new Error("Network response was not ok");const j=await f.json();n("/search",{state:{searchResults:j.data,searchParams:t}})}catch(f){console.error("Error fetching flight data:",f),p("Failed to fetch flight data.")}finally{b(!1)}},[t,n]),q=s.useCallback((a,c)=>{c&&m(a,K(c,"yyyy-MM-dd"))},[m]);return e.jsx("div",{className:"flex flex-col gap-5 w-full items-center px-4",children:e.jsxs("div",{className:"flex lg:flex-row flex-col lg:gap-12 md:gap-9 sm:gap-6 gap-4 w-full lg:items-center justify-between",children:[e.jsxs("div",{className:"flex lg:flex-row flex-col items-center lg:gap-6 gap-3",children:[e.jsx(V,{data:o,placeholder:"City",onSearch:D,loading:h,value:t==null?void 0:t.departureCity,onChange:a=>m("departureCity",a)}),e.jsx("div",{className:"lg:w-[50px] lg:h-[50px] lg:p-3 w-[45px] h-[45px] p-2 rounded-full bg-primaryRed bg-opacity-[8%]",children:e.jsx(de,{size:"10",stroke:"#E5302f"})}),e.jsx(V,{data:g,placeholder:"City",onSearch:k,loading:i,value:t==null?void 0:t.arrivalCity,onChange:a=>m("arrivalCity",a)})]}),e.jsx(X,{onChange:a=>q("departureDate",a),value:new Date(t==null?void 0:t.departureDate)}),(t==null?void 0:t.returnDate)&&e.jsx(X,{onChange:a=>q("returnDate",a),value:new Date(t.returnDate)}),e.jsx(xe,{data:ue,placeholder:"Class",value:t.selectedClass,onChange:a=>m("selectedClass",a)}),e.jsx(ge,{btnText:"Add Passenger",children:e.jsxs("div",{className:"flex flex-col gap-3 py-2",children:[e.jsx(O,{label:"Adults ( â‰¥ 12 years)",count:t==null?void 0:t.adultCount,increment:ae,decrement:se}),e.jsx(O,{label:"Children ( 2 - 12 years)",count:t==null?void 0:t.childCount,increment:le,decrement:ne}),e.jsx(O,{label:"Infants ( < 2 years)",count:t==null?void 0:t.infantCount,increment:ie,decrement:oe})]})}),e.jsx(_,{onClick:re,className:"bg-primaryRed duration-300 lg:w-[120px] w-[100px] h-12",disabled:r,children:r?e.jsx($,{color:"#FFFFFF",size:"20"}):"Search"})]})})},Te=(t,d)=>new Intl.NumberFormat("en-US",{style:"currency",currency:t}).format(parseFloat(d)),Fe=t=>t.replace("PT","").replace("H","H "),Ee=(t,d)=>{const n=new Date(d).getTime()-new Date(t).getTime(),o=Math.floor(n/(1e3*60*60)),x=Math.floor(n%(1e3*60*60)/(1e3*60));return`${o}h ${x}m`},Re=t=>t===1?"non-stop":`${t-1} ${t-1===1?"stop":"stops"}`,Oe=t=>new Date(t).toLocaleDateString("en-GB",{day:"2-digit",month:"long",year:"numeric"}),z=10,Le=({itinerary1:t,itinerary2:d,result:n})=>{const o=Q(),[x,g]=s.useState(!1),C=async()=>{g(!0);try{const r=localStorage.getItem("confirmPriceToken");if(!r){alert("Authorization token is missing. Please log in again.");return}const b={data:{type:"flight-offers-pricing",flightOffers:[n]}},h=await fetch("https://test.ffsdtravels.com/api/flight/price/confirm",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`},body:JSON.stringify(b)}),y=await h.json();if(h.ok){const{bookingRequirements:i,accessToken:u}=y.data;localStorage.setItem("payToken",u),localStorage.setItem("bookingRequirements",JSON.stringify(i)),localStorage.setItem("travelerRequirements",JSON.stringify(i.travelerRequirements)),localStorage.setItem("selectedFlight",JSON.stringify(n));const v=["emailAddressRequired","mobilePhoneNumberRequired"],D=Object.keys(i),S=D.length===v.length&&v.every(k=>D.includes(k));o(S?"/book-flight":"/book-flight2")}else alert(`Price confirmation failed: ${y.message||"Unknown error"} (Status: ${h.status})`)}catch(r){console.error("Error confirming price:",r),alert("An error occurred while confirming the price. Please try again.")}};return n.itineraries.length?e.jsx("div",{className:"flex flex-col gap-4",children:e.jsx(Z,{className:"bg-white shadow-md p-4 rounded-sm",children:e.jsxs(me,{className:"p-0",children:[e.jsxs("div",{className:"p-2 border-b-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center lg:gap-3 md:gap-3 gap-1",children:[e.jsx("img",{src:`${P}${t.segments[0].airlineLogo}`,alt:`${t.segments[0].airlineName} logo`,className:"lg:w-10 md:w-10 sm:w-8 w-8 lg:h-10 md:h-10 sm:h-8 h-8 object-cover"}),e.jsx("div",{children:e.jsx("b",{className:"lg:text-base md:text-base sm:text-[10px] text-[11px]",children:t.segments[0].airlineName})})]}),e.jsx("div",{className:"flex lg:gap-5 gap-3 items-center",children:e.jsxs("div",{className:"text-end",children:[e.jsx("p",{className:"capitalize lg:text-sm text-[12px] font-medium",children:"Full pay"}),e.jsx("p",{className:"lg:text-sm text-[12px] sm:tracking-tight sm:leading-4 font-semibold text-gray-600",children:Te(n.price.currency,n.price.ffsd_total)})]})})]}),e.jsxs("div",{className:"mt-3",children:[e.jsx("div",{className:"flex items-center lg:space-x-2 space-x-1 justify-between",children:e.jsxs("p",{className:"capitalize lg:text-base lg:w-[40%] w-[30%] text-[12px] text-gray-600",children:[e.jsx("span",{className:"font-bold text-black",children:"Departure Date"})," ",e.jsx("span",{className:"font-medium",children:Oe(t.segments[0].departure.at)}),e.jsx("span",{className:"mx-2 w-1 h-1 bg-gray-600 rounded-full"})]})}),e.jsxs("div",{className:"flex items-center justify-between lg:space-x-2 space-x-1 p-3 rounded-xs mt-2",children:[e.jsx("div",{className:"flex flex-col items-start w-[35%]",children:e.jsx("p",{className:"font-semibold text-gray-500 text-start capitalize tracking-tighter leading-4 lg:text-base text-[12px]",children:t.segments[0].departure_airport})}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(ee,{}),e.jsx("p",{className:"font-bold text-start capitalize lg:text-lg text-[12px]",children:Fe(t.duration)}),e.jsx("p",{className:"font-semibold text-gray-500 text-end capitalize tracking-tighter leading-4 lg:text-base text-[8.5px]",children:Re(t.segments.length)})]}),e.jsx("div",{className:"flex flex-col items-end w-[35%]",children:e.jsx("p",{className:"font-semibold text-gray-500 text-end capitalize tracking-tighter leading-4 lg:text-base text-[12px]",children:t.segments[t.segments.length-1].arrival_airport})})]})]}),e.jsx("hr",{}),e.jsx(je,{type:"single",collapsible:!0,className:"w-full",children:e.jsxs(ye,{value:"item-1",className:"border-none",children:[e.jsx(Ce,{className:"font-medium px-2 capitalize",children:e.jsx("p",{className:"font-bold text-black capitalize",children:"Flight Details"})}),e.jsxs(be,{className:"p-4 flex flex-col gap-4 rounded-sm",children:[e.jsx("p",{className:"font-bold text-gray-700",children:"Outbound"}),t.segments.map(r=>e.jsx(Y,{segment:r,travelerPricings:n.travelerPricings},r.id)),e.jsx("div",{className:"flex mt-2 w-full justify-end",children:e.jsx(_,{className:"bg-primaryRed lg:text-sm text-[11px] hover:bg-black text-white",onClick:C,children:x?e.jsx($,{color:"#FFFFFF",size:"20"}):"Book Flight"})}),d&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"font-bold text-gray-700 mt-4",children:"Inbound"}),d.segments.map(r=>e.jsx(Y,{segment:r,travelerPricings:n.travelerPricings},r.id)),e.jsx("div",{className:"flex mt-2 w-full justify-end",children:e.jsx(_,{className:"bg-primaryRed lg:text-sm text-[11px] hover:bg-black text-white",onClick:C,children:x?e.jsx($,{color:"#FFFFFF",size:"20"}):"Book Flight"})})]})]})]})})]})})}):null},Y=({segment:t,travelerPricings:d})=>e.jsxs("div",{className:"mt-3 bg-gray-100 rounded-xs",children:[e.jsxs("div",{className:"flex items-center lg:space-x-2 space-x-1 justify-between p-3 ",children:[e.jsxs("p",{className:"capitalize lg:text-base lg:w-[40%] w-[30%] text-[12px]  text-gray-600",children:[e.jsx("span",{className:"font-bold text-black",children:"Departure"})," ",e.jsx("span",{className:"font-medium",children:t.departure_airport})," ",e.jsx("span",{className:"w-2 h-2 bg-gray-600 rounded-full"}),e.jsx("span",{className:"font-bold text-black",children:new Date(t.departure.at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{className:"flex items-center lg:gap-3 md:gap-3 gap-1",children:[e.jsx("img",{src:`${P}${t==null?void 0:t.airlineLogo}`,alt:`${t==null?void 0:t.airlineName} logo`,className:"lg:w-10 md:w-10 sm:w-8 w-8 lg:h-10 md:h-10 sm:h-8 h-8 object-cover"}),e.jsx("div",{children:e.jsx("b",{className:"lg:text-base md:text-base sm:text-[10px] text-[11px]",children:t.airlineName})})]})]}),e.jsxs("div",{className:"flex flex-col gap-y-4 bg-gray-100 rounded-xs p-3  mt-2",children:[e.jsxs("div",{className:"flex items-center justify-between lg:space-x-2 space-x-1 w-full",children:[e.jsxs("div",{className:"flex flex-col items-start w-[35%]",children:[e.jsx("p",{className:"font-bold capitalize lg:text-sm text-[12px]",children:new Date(t.departure.at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsx("p",{className:"font-semibold text-gray-500 text-start capitalize tracking-tighter leading-4 lg:text-base text-[8.5px]",children:t.departure_airport})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx(ee,{}),e.jsx("p",{className:"font-semibold text-gray-500 text-end capitalize tracking-tighter leading-4 lg:text-base text-[8.5px]",children:t.numberOfStops===0?"No stop":`${t.numberOfStops} stops`}),e.jsx("p",{className:"font-bold text-start capitalize lg:text-lg text-[12px]",children:Ee(t.departure.at,t.arrival.at)})]}),e.jsxs("div",{className:"flex flex-col items-end w-[35%]",children:[e.jsx("p",{className:"font-bold capitalize lg:text-sm text-[12px]",children:new Date(t.arrival.at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),e.jsx("p",{className:"font-semibold text-gray-500 text-end capitalize tracking-tighter leading-4 lg:text-base text-[8.5px]",children:t.arrival_airport})]})]}),e.jsxs("div",{className:"flex items-center justify-between lg:space-x-2 space-x-1 w-full",children:[e.jsxs("div",{className:"flex flex-col items-start w-[35%]",children:[e.jsx("p",{className:"font-bold capitalize lg:text-sm text-[12px]",children:"Baggage"}),d.map((n,o)=>{var x,g;return e.jsx("div",{className:"w-full flex flex-col items-start",children:e.jsxs("p",{className:" flex font-semibold text-gray-500 text-start capitalize tracking-tighter leading-4 lg:text-base text-[12px]",children:[e.jsx(Ie,{}),((g=(x=n.fareDetailsBySegment[0])==null?void 0:x.includedCheckedBags)==null?void 0:g.quantity)??0," ","X 23kg"]})},o)})]}),e.jsxs("div",{className:"flex flex-col items-end w-[35%]",children:[e.jsx("p",{className:"font-bold capitalize lg:text-sm text-[12px]",children:"Airline"}),e.jsxs("p",{className:"font-semibold text-gray-500 text-start capitalize tracking-tighter leading-4 lg:text-base text-[8.5px]",children:[t.carrierCode," - ",t.number]})]})]})]})]}),ze=({searchData:t})=>{var h,y;const d=W(),n=Array.isArray((h=d.state)==null?void 0:h.searchResults)?d.state.searchResults:Object.values((y=d.state)==null?void 0:y.searchResults),[o,x]=s.useState(1),g=Math.ceil(n.length/z),C=(o-1)*z,r=C+z,b=n.slice(C,r);return n.length?e.jsxs("div",{className:"flex flex-col gap-3",children:[b.map(i=>e.jsx(Le,{itinerary1:i.itineraries[0],itinerary2:i.itineraries[1],result:i},i.id)),e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(ve,{children:e.jsxs(we,{children:[e.jsx(L,{children:e.jsx(De,{href:"#",onClick:i=>{i.preventDefault(),o>1&&x(o-1)}})}),Array.from({length:g},(i,u)=>e.jsx(L,{children:e.jsx(Se,{href:"#",isActive:o===u+1,onClick:v=>{v.preventDefault(),x(u+1)},children:u+1})},u+1)),e.jsx(L,{children:e.jsx(ke,{href:"#",onClick:i=>{i.preventDefault(),o<g&&x(o+1)}})})]})})})]}):e.jsxs(Z,{className:"text-center bg-white shadow-md p-4 rounded-sm",children:[e.jsx(he,{className:"text-lg font-semibold mt-0",children:e.jsx("p",{className:"text-xl font-semibold",children:"No search results found."})}),e.jsx("p",{className:"text-gray-600 font-medium",children:"Please try adjusting your search criteria."})]})},Be=()=>{var h,y,i;const t=W(),n=(h=t.state)==null?void 0:h.searchResults,o=((y=t.state)==null?void 0:y.searchParams)||{departureCity:"",arrivalCity:"",departureDate:"",returnDate:"",adultCount:0,childCount:0,infantCount:0,selectedClass:""},[x,g]=s.useState(o),[C,r]=s.useState(n);s.useEffect(()=>{var u;(u=t.state)!=null&&u.searchParams&&g(t.state.searchParams)},[(i=t.state)==null?void 0:i.searchParams]);const b=s.useCallback(u=>{g(u)},[]);return s.useCallback(u=>{r(u)},[]),e.jsxs(e.Fragment,{children:[e.jsx(Ne,{}),e.jsxs("div",{className:"w-full overflow-hidden pt-4 section-width",children:[e.jsx("div",{className:"w-full lg:flex hidden",children:e.jsx(Ae,{searchParams:x,onChange:b})}),e.jsx("div",{className:"flex flex-1 mt-3 gap-2 justify-between",children:e.jsx("div",{className:"w-full overflow-hidden px-4 my-3",children:e.jsx(ze,{searchData:C})})})]})]})};export{Be as default};
