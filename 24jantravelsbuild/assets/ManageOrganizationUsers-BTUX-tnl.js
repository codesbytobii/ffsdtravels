import{r as i,y as n,_,$ as k,j as e,B as T,L as B,a5 as D,a6 as O,a7 as M}from"./index-DBncHmhw.js";import{a as R}from"./index-BW20yMBF.js";import{z as U,d as V,t as X,e as Y,I as z}from"./index-D-uqktI-.js";const q=U.object({firstName:U.string().min(2,{message:"At least 2 characters."}).max(30,{message:"At most 30 characters."}),lastName:U.string().min(2,{message:"At least 2 characters."}).max(30,{message:"At most 30 characters."}),email:U.string().email({message:"Invalid email address"}),phone:U.string().min(2,{message:"Enter phone number"})}),G=({user:N,onSubmit:y})=>{const l=V({resolver:X(q),mode:"onChange",defaultValues:N||{}}),{handleSubmit:A,getValues:C,formState:{errors:g}}=l,[F,E]=i.useState(!1),[I,x]=i.useState([]);console.log(I),i.useEffect(()=>{const c=localStorage.getItem("userToken");if(!c){n.error("User token is missing. Please log in.");return}_.get(`${k}countries`,{headers:{Authorization:`Bearer ${c}`,Accept:"application/json"}}).then(t=>{const d=t.data;x(d)}).catch(t=>{var p,m;const d=((m=(p=t==null?void 0:t.response)==null?void 0:p.data)==null?void 0:m.message)||"Unknown error";n.error(`Error fetching data: ${d}`)})},[]);const b=async()=>{var $,s,o,u,j,h,S;const c=localStorage.getItem("userToken"),{firstName:t,lastName:d,email:p,phone:m}=C();E(!0);try{if(N){const a=await _.post(`${k}user/edit`,{firstName:t,lastName:d,email:p,phone:m},{headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json",Accept:"application/json"}});(($=a==null?void 0:a.data)==null?void 0:$.success)===!0&&(n.success("User updated successfully!"),y&&y(a.data.user))}else{const a=await _.post(`${k}org/create/staff`,{firstName:t,lastName:d,email:p,phone:m},{headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json",Accept:"application/json"}});((s=a==null?void 0:a.data)==null?void 0:s.success)===!0&&n.success((o=a==null?void 0:a.data)==null?void 0:o.message)}}catch(a){const r=a;(j=(u=r.response)==null?void 0:u.data)!=null&&j.errors?r.response.data.errors.email&&n.error(r.response.data.errors.email.join(", ")):(S=(h=r.response)==null?void 0:h.data)!=null&&S.message?n.error(r.response.data.message):n.error("An unexpected error occurred.")}finally{E(!1)}};return e.jsx(Y,{...l,children:e.jsxs("form",{onSubmit:A(b),children:[e.jsxs("div",{className:"grid lg:grid-cols-3 grid-cols-2 gap-4 gap-y-6",children:[e.jsx(z,{label:"First Name",name:"firstName",register:l.register,errors:g}),e.jsx(z,{label:"Last Name",name:"lastName",register:l.register,errors:g}),e.jsx(z,{label:"Email",name:"email",register:l.register,errors:g}),e.jsx(z,{label:"Phone Number",name:"phone",register:l.register,errors:g})]}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx(T,{type:"submit",disabled:F,className:"bg-primaryRed duration-300 capitalize w-52",children:F?e.jsx(B,{color:"#FFFFFF",size:"20"}):N?"Update Staff":"Create Staff"})})]})})},Q=()=>{const[N,y]=i.useState([]),[l,A]=i.useState(!0),[C,g]=i.useState(1),[F,E]=i.useState(1),[I,x]=i.useState(!1),[b,c]=i.useState(null),t=s=>{const o=new Date(s),u=String(o.getDate()).padStart(2,"0"),j=String(o.getMonth()+1).padStart(2,"0"),h=o.getFullYear();return`${u}-${j}-${h}`};i.useEffect(()=>{const s=localStorage.getItem("userToken"),o=localStorage.getItem("organizationId");if(!s){n.error("User token is missing. Please log in.");return}(async j=>{var h,S,a;try{const r=await _.get(`${k}users/all?page=${j}`,{headers:{Authorization:`Bearer ${s}`,Accept:"application/json"}}),{data:v,current_page:L,last_page:P}=(h=r==null?void 0:r.data)==null?void 0:h.users,w=v.filter(f=>f.user_company_id===o).map(f=>({...f,name:`${f.lastName} ${f.firstName}`,created_at:t(f.created_at),updated_at:t(f.updated_at)}));y(w),g(L),E(P),A(!1)}catch(r){const v=r;(a=(S=v.response)==null?void 0:S.data)!=null&&a.message?n.error(v.response.data.message):n.error("An unexpected error occurred.")}finally{A(!1)}})(C)},[C]);const d=s=>{c(s),x(!0)},p=s=>{y(o=>o.map(u=>u.id===s.id?s:u)),c(null),x(!1),n.success("User updated successfully.")},m=()=>{c(null),x(!1)},$=[{header:"Name",accessor:"name"},{header:"User Type",accessor:"user_type"},{header:"Phone Number",accessor:"phone"},{header:"Email Address",accessor:"email"},{header:"Created At",accessor:"created_at"},{header:"Updated At",accessor:"updated_at"},{header:"Edit",accessor:"edit",Cell:({row:s})=>e.jsx("button",{onClick:()=>d(s.original),children:e.jsx(R,{className:"text-blue-500 hover:text-blue-700"})})}];return e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex gap-4 mt-5",children:[e.jsx(T,{onClick:()=>x(!0),className:"bg-primaryRed text-white w-52 rounded capitalize","aria-label":"Create User",children:"Create User"}),e.jsx(D,{isOpen:I,onClose:m,children:e.jsxs("div",{className:"flex flex-col lg:p-10 md:p-8 sm:p-6 p-4 pb-0 m-0",children:[e.jsxs("div",{className:"rounded-md flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("h1",{className:"text-gray-700 font-bold",children:b?"Edit User":"Create User"}),e.jsx("p",{className:"text-gray-600 font-bold",children:b?"Edit user details.":"Create an Admin and Organization user."})]}),e.jsx("button",{onClick:m,"aria-label":"Close",children:e.jsx(O,{size:30})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(G,{user:b,onSubmit:p})})]})})]}),e.jsx("div",{className:"mt-7",children:l?e.jsxs("div",{className:"flex justify-center items-center",children:[e.jsx("p",{children:"Loading..."})," "]}):e.jsx(M,{data:N,columns:$,totalPages:F,currentPage:C,onPageChange:g,isLoading:!1})})]})};export{Q as default};
