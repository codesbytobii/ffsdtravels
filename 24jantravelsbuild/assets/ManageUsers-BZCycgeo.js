import{r as o,j as e,y as u,_ as z,$ as L,B as M,L as V,a3 as X,a4 as Y,a5 as q,a6 as G,a7 as H}from"./index-DBncHmhw.js";import{F as J,a as Q}from"./index-BW20yMBF.js";import{f as W,F as Z,a as K,z as h,d as ee,t as ae,e as se,I as E}from"./index-D-uqktI-.js";const I=({label:f,name:m,errors:c,options:T})=>{var p;const[x,n]=o.useState(""),[g,j]=o.useState(!1),v=o.useRef(null),{field:y}=W({name:m}),b=T.filter(s=>s.label.toLowerCase().includes(x.toLowerCase()));return o.useEffect(()=>{const s=w=>{v.current&&!v.current.contains(w.target)&&j(!1)};return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[]),e.jsxs(Z,{className:"relative",ref:v,children:[e.jsx(K,{children:f}),e.jsx("input",{type:"text",placeholder:`Search ${f}`,value:x,onChange:s=>n(s.target.value),onClick:()=>j(!g),"aria-expanded":g,"aria-controls":`dropdown-${m}`,className:"px-3 py-2 border border-gray-300 focus:border-primaryRed focus:border-2 focus:ring-0 outline-none rounded w-full pr-10 transition-colors duration-300 ease-in-out"}),e.jsx(J,{className:`absolute right-3 top-[45px] transform -translate-y-1/2 ${g?"text-primaryRed":"text-gray-500"}`,size:25}),g&&e.jsx("div",{id:`dropdown-${m}`,className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded shadow-lg z-10 overflow-y-auto max-h-44 custom__scrollbar",children:b.length>0?b.map(s=>e.jsx("div",{onClick:()=>{n(s.label),j(!1),y.onChange(s.value),y.onBlur()},className:"px-3 py-2 cursor-pointer hover:bg-gray-100",children:s.label},s.value)):e.jsx("div",{className:"px-3 py-2 text-gray-500",children:"No options available"})}),c[m]&&e.jsx("p",{className:"text-red-500 text-xs mt-1",children:(p=c[m])==null?void 0:p.message})]})},te=h.object({firstName:h.string().min(2,{message:"At least 2 characters."}).max(30,{message:"At most 30 characters."}),lastName:h.string().min(2,{message:"At least 2 characters."}).max(30,{message:"At most 30 characters."}),email:h.string().email({message:"Invalid email address"}),phone:h.string().min(2,{message:"Enter phone number"}),companyName:h.string().min(2).max(150),companyCountry:h.string({message:"Select a country"}),user_type:h.string({message:"Select a User type"}),paymentType:h.string({message:"Select a payment type"})}),re=({user:f,onSubmit:m})=>{const c=ee({resolver:ae(te),mode:"onChange",defaultValues:f||{}}),{handleSubmit:T,getValues:x,formState:{errors:n}}=c,[g,j]=o.useState(!1),[v,y]=o.useState([]);o.useEffect(()=>{const i=localStorage.getItem("userToken");if(!i){u.error("User token is missing. Please log in.");return}z.get(`${L}countries`,{headers:{Authorization:`Bearer ${i}`,Accept:"application/json"}}).then(d=>{const a=d.data;y(a)}).catch(d=>{var r,t;const a=((t=(r=d==null?void 0:d.response)==null?void 0:r.data)==null?void 0:t.message)||"Unknown error";u.error(`Error fetching data: ${a}`)})},[]);const b=async()=>{var _,k,O,S,B,R,D;const i=localStorage.getItem("userToken"),{firstName:d,lastName:a,email:r,phone:t,companyName:F,companyCountry:C,user_type:A,paymentType:N}=x(),U=typeof C=="string"?parseFloat(C):C;j(!0);try{if(f){const l=await z.post(`${L}user/edit`,{firstName:d,lastName:a,email:r,phone:t,companyName:F,companyCountry:U,user_type:A,paymentType:N},{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json",Accept:"application/json"}});((_=l==null?void 0:l.data)==null?void 0:_.success)===!0&&(u.success("User updated successfully!"),m&&m(l.data.user))}else{const l=await z.post(`${L}create/company`,{firstName:d,lastName:a,email:r,phone:t,companyName:F,companyCountry:U,user_type:A,paymentType:N},{headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json",Accept:"application/json"}});((k=l==null?void 0:l.data)==null?void 0:k.success)===!0&&u.success((O=l==null?void 0:l.data)==null?void 0:O.message)}}catch(l){const $=l;(B=(S=$.response)==null?void 0:S.data)!=null&&B.errors?$.response.data.errors.email&&u.error($.response.data.errors.email.join(", ")):(D=(R=$.response)==null?void 0:R.data)!=null&&D.message?u.error($.response.data.message):u.error("An unexpected error occurred.")}finally{j(!1)}},p=(i,d,a,r)=>!Array.isArray(i)||i.length===0?[]:i.map(t=>({label:String(t[d]),value:String(r?t[r]:t[a])})),s=p(v,"country","id","id"),w=p(X,"label","value"),P=p(Y,"label","value");return e.jsx(se,{...c,children:e.jsxs("form",{onSubmit:T(b),children:[e.jsxs("div",{className:"grid lg:grid-cols-3 grid-cols-2 gap-4 gap-y-6",children:[e.jsx(E,{label:"First Name",name:"firstName",register:c.register,errors:n}),e.jsx(E,{label:"Last Name",name:"lastName",register:c.register,errors:n}),e.jsx(E,{label:"Email",name:"email",register:c.register,errors:n}),e.jsx(E,{label:"Phone Number",name:"phone",register:c.register,errors:n}),e.jsx(E,{label:"Company Name",name:"companyName",register:c.register,errors:n}),e.jsx(I,{label:"Country",name:"companyCountry",errors:n,options:s}),e.jsx(I,{label:"User Type",name:"user_type",errors:n,options:w}),e.jsx(I,{label:"Payment Type",name:"paymentType",errors:n,options:P})]}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx(M,{type:"submit",disabled:g,className:"bg-primaryRed duration-300 capitalize w-52",children:g?e.jsx(V,{color:"#FFFFFF",size:"20"}):f?"Update User":"Create Company"})})]})})},ce=()=>{const[f,m]=o.useState([]),[c,T]=o.useState(!0),[x,n]=o.useState(1),[g,j]=o.useState(1),[v,y]=o.useState(!1),[b,p]=o.useState(null),s=a=>{const r=new Date(a),t=String(r.getDate()).padStart(2,"0"),F=String(r.getMonth()+1).padStart(2,"0"),C=r.getFullYear();return`${t}-${F}-${C}`};o.useEffect(()=>{const a=localStorage.getItem("userToken");if(!a){u.error("User token is missing. Please log in.");return}(async t=>{var F,C,A;try{const N=await z.get(`${L}users/all?page=${t}`,{headers:{Authorization:`Bearer ${a}`,Accept:"application/json"}}),{data:U,current_page:_,last_page:k}=(F=N==null?void 0:N.data)==null?void 0:F.users,O=U.map(S=>({...S,name:`${S.lastName} ${S.firstName}`,created_at:s(S.created_at),updated_at:s(S.updated_at)}));m(O),n(_),j(k),T(!1)}catch(N){const U=N;(A=(C=U.response)==null?void 0:C.data)!=null&&A.message?u.error(U.response.data.message):u.error("An unexpected error occurred.")}finally{T(!1)}})(x)},[x]);const w=a=>{p(a),y(!0)},P=a=>{m(r=>r.map(t=>t.id===a.id?a:t)),p(null),y(!1),u.success("User updated successfully.")},i=()=>{p(null),y(!1)},d=[{header:"Name",accessor:"name"},{header:"User Type",accessor:"user_type"},{header:"Phone Number",accessor:"phone"},{header:"Email Address",accessor:"email"},{header:"Created At",accessor:"created_at"},{header:"Updated At",accessor:"updated_at"},{header:"Edit",accessor:"edit",Cell:({row:a})=>e.jsx("button",{onClick:()=>w(a.original),children:e.jsx(Q,{className:"text-blue-500 hover:text-blue-700"})})}];return e.jsxs("div",{className:"flex flex-col ",children:[e.jsxs("div",{className:"flex gap-4 mt-5",children:[e.jsx(M,{onClick:()=>y(!0),className:"bg-primaryRed text-white w-52 rounded capitalize","aria-label":"Create User",children:"Create User"}),e.jsx(q,{isOpen:v,onClose:i,children:e.jsxs("div",{className:"flex flex-col lg:p-10 md:p-8 sm:p-6 p-4 pb-0 m-0",children:[e.jsxs("div",{className:"rounded-md flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("h1",{className:"text-gray-700 font-bold",children:b?"Edit User":"Create User"}),e.jsx("p",{className:"text-gray-600 font-bold",children:b?"Edit user details.":"Create an Admin and Organization user."})]}),e.jsx("button",{onClick:i,"aria-label":"Close",children:e.jsx(G,{size:30})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(re,{user:b,onSubmit:P})})]})})]}),e.jsx("div",{className:"mt-7",children:e.jsx(H,{data:f,columns:d,isLoading:c,totalPages:g,currentPage:x,onPageChange:n})})]})};export{ce as default};
